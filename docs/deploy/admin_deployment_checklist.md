# üìã –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–ø–ª–æ—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä 176.98.176.195

## üéØ –¶–µ–ª—å
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–µ–ø–ª–æ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ kirdro.ru –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Å–µ—Ä–≤–µ—Ä–µ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–¥–∞–∫—à–Ω —Å–∞–π—Ç–∞.

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ–ø–ª–æ—è
- **–°–µ—Ä–≤–µ—Ä**: 176.98.176.195 (—Ç–æ—Ç –∂–µ —á—Ç–æ —É –ø—Ä–æ–¥–∞–∫—à–Ω–∞)
- **–î–æ–º–µ–Ω**: admin.kirdro.ru  
- **–ü–æ—Ä—Ç**: 3005 (–∏–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å :3003 –ø—Ä–æ–¥–∞–∫—à–Ω)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä**: kirdro-portfolio-admin
- **–í–µ—Ç–∫–∞ –¥–µ–ø–ª–æ—è**: main
- **–û–∫—Ä—É–∂–µ–Ω–∏–µ**: admin

---

## ‚úÖ –§–∞–∑–∞ 1: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ (–í–´–ü–û–õ–ù–ï–ù–û)

### 1.1 –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã
- [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É `ssh root@176.98.176.195`
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤: 27GB —Å–≤–æ–±–æ–¥–Ω–æ, 1.2GB RAM –¥–æ—Å—Ç—É–ø–Ω–æ
- [x] –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ kirdro-portfolio-prod –Ω–∞ :3003)
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤ (:3005 —Å–≤–æ–±–æ–¥–µ–Ω ‚úÖ)
- [x] –ò–∑—É—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Caddy –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 1.2 –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] Caddy —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
- [x] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–ø–æ—Ä—Ç—ã 80, 443 –æ—Ç–∫—Ä—ã—Ç—ã)
- [x] Docker daemon –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## ‚úÖ –§–∞–∑–∞ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (–í –ü–†–û–¶–ï–°–°–ï)

### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- [x] –°–æ–∑–¥–∞–Ω–∏–µ `/var/docker/kirdro-admin/`
- [x] –°–æ–∑–¥–∞–Ω–∏–µ `/var/logs/kirdro-admin/` 
- [x] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ª–æ–≥–æ–≤ Caddy

### 2.2 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] –°–æ–∑–¥–∞–Ω–∏–µ `.env.admin` —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
  - NODE_ENV=production
  - NEXTAUTH_URL=https://admin.kirdro.ru
  - PORT=3005
  - DATABASE_URL (—Ç–∞ –∂–µ –±–∞–∑–∞ —á—Ç–æ —É –ø—Ä–æ–¥–∞–∫—à–Ω–∞)
- [x] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–∞–≤ (chmod 600)

### 2.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Caddy –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é –¥–ª—è admin.kirdro.ru –≤ Caddyfile
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å reverse_proxy –Ω–∞ localhost:3005
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ /var/logs/kirdro-admin/
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Caddy

---

## üîê –§–∞–∑–∞ 3: SSH –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å 

### 3.1 –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–µ–π –¥–ª—è GitHub Actions
```bash
# –ù–ê –õ–û–ö–ê–õ–¨–ù–û–ô –ú–ê–®–ò–ù–ï
ssh-keygen -t ed25519 -C "github-actions-admin-deploy" -f ~/.ssh/kirdro_admin_deploy -N ""
ssh-copy-id -i ~/.ssh/kirdro_admin_deploy.pub root@176.98.176.195
ssh -i ~/.ssh/kirdro_admin_deploy root@176.98.176.195 "echo 'SSH –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç!'"
```

### 3.2 GitHub Secrets
- [ ] ADMIN_DEPLOY_HOST = 176.98.176.195
- [ ] ADMIN_DEPLOY_USER = root  
- [ ] ADMIN_DEPLOY_KEY = [–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á]

---

## üöÄ –§–∞–∑–∞ 4: GitHub Actions

### 4.1 Workflow —Ñ–∞–π–ª
- [ ] –°–æ–∑–¥–∞—Ç—å `.github/workflows/deploy-admin.yml`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–∞–ø—ã:
  - TypeScript check
  - Docker build (–æ–±—Ä–∞–∑ kirdro-portfolio-admin:latest)
  - Deploy –Ω–∞ –ø–æ—Ä—Ç 3005
  - Health check (https://admin.kirdro.ru/api/health)

### 4.2 Docker –¥–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç
```bash
# –í workflow - –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–ø–ª–æ—è
docker stop kirdro-portfolio-admin || true
docker rm kirdro-portfolio-admin || true
docker run -d \
  --name kirdro-portfolio-admin \
  --restart unless-stopped \
  -p 127.0.0.1:3005:3005 \
  --env-file /var/docker/kirdro-admin/.env.admin \
  kirdro-portfolio-admin:latest
```

---

## üåê –§–∞–∑–∞ 5: DNS –∏ OAuth

### 5.1 DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] –°–æ–∑–¥–∞—Ç—å A-–∑–∞–ø–∏—Å—å: admin.kirdro.ru ‚Üí 176.98.176.195
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ DNS: `dig admin.kirdro.ru`

### 5.2 Yandex OAuth –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ  
- [ ] –î–æ–±–∞–≤–∏—Ç—å redirect URI: `https://admin.kirdro.ru/api/auth/callback/yandex`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

---

## üß™ –§–∞–∑–∞ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 6.1 –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker ps | grep kirdro-admin`
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å https://admin.kirdro.ru

### 6.2 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Yandex —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ
- [ ] API endpoints –æ—Ç–≤–µ—á–∞—é—Ç
- [ ] –ü—Ä–æ–¥–∞–∫—à–Ω —Å–∞–π—Ç –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç

---

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### üö® –ù–ï –¢–†–û–ì–ê–¢–¨:
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä kirdro-portfolio-prod (–ø–æ—Ä—Ç 3003)
- –û—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å Caddyfile –¥–ª—è kirdro.ru
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /var/docker/kirdro/
- –õ—é–±—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–¥–∞–∫—à–Ω–∞

### ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û –ò–ó–ú–ï–ù–Ø–¢–¨:
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏ –≤ Caddyfile
- –°–æ–∑–¥–∞–≤–∞—Ç—å /var/docker/kirdro-admin/
- –î–æ–±–∞–≤–ª—è—Ç—å SSH –∫–ª—é—á–∏ –≤ authorized_keys
- –°–æ–∑–¥–∞–≤–∞—Ç—å GitHub Actions workflows

---

## üìä –§–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
```
‚îå‚îÄ Production ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ Admin Panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ https://kirdro.ru           ‚îÇ  ‚îÇ https://admin.kirdro.ru        ‚îÇ
‚îÇ Container: kirdro-prod      ‚îÇ  ‚îÇ Container: kirdro-admin        ‚îÇ  
‚îÇ Port: :3003                 ‚îÇ  ‚îÇ Port: :3005                    ‚îÇ
‚îÇ Branch: main                ‚îÇ  ‚îÇ Branch: main                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îî‚îÄ Shared PostgreSQL DB (109.196.100.98:5432)
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–π
- –ü—Ä–∏ –ª—é–±—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `journalctl -u caddy -f` –∏ `docker logs kirdro-portfolio-admin -f`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ, –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

*–°–æ–∑–¥–∞–Ω–æ: 11.09.2025*  
*–°–µ—Ä–≤–µ—Ä: 176.98.176.195 (Ubuntu)*