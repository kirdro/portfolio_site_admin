# üîê –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ KIRDRO Admin

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **NextAuth.js v4** —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º **–Ø–Ω–¥–µ–∫—Å OAuth** –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ `kirdro@yandex.ru`.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 1. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
src/
‚îú‚îÄ‚îÄ server/auth.ts          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NextAuth.js
‚îú‚îÄ‚îÄ middleware.ts           # Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤  
‚îú‚îÄ‚îÄ app/auth/               # –°—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ signin/page.tsx     # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ error/page.tsx      # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ app/api/auth/           # API –º–∞—Ä—à—Ä—É—Ç—ã NextAuth.js
    ‚îî‚îÄ‚îÄ [...nextauth]/
```

### 2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

- **JWT-based** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ë–î –¥–ª—è —Å–µ—Å—Å–∏–π)
- **–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä**: –Ø–Ω–¥–µ–∫—Å OAuth
- **–°—Ç—Ä–æ–≥–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è `kirdro@yandex.ru`
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 24 —á–∞—Å–∞ –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å–µ—Å—Å–∏–π

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NextAuth.js

### –§–∞–π–ª: `src/server/auth.ts`

#### –ö–∞—Å—Ç–æ–º–Ω—ã–π –Ø–Ω–¥–µ–∫—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä

```typescript
const YandexProvider = {
  id: "yandex",
  name: "Yandex", 
  type: "oauth" as const,
  authorization: {
    url: "https://oauth.yandex.ru/authorize",
    params: {
      scope: "login:email login:info",
      response_type: "code",
    },
  },
  token: "https://oauth.yandex.ru/token",
  userinfo: "https://login.yandex.ru/info?format=json",
  clientId: process.env.AUTH_YANDEX_ID!,
  clientSecret: process.env.AUTH_YANDEX_SECRET!,
  profile(profile: any) {
    return {
      id: profile.id,
      name: profile.display_name || profile.real_name,
      email: profile.default_email,
      image: profile.is_avatar_empty 
        ? null 
        : `https://avatars.yandex.net/get-yapic/${profile.default_avatar_id}/islands-200`,
    };
  },
};
```

#### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **–ë–µ–∑ Prisma –∞–¥–∞–ø—Ç–µ—Ä–∞** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ JWT
2. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–µ—Å—Å–∏–∏**: JWT
3. **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 24 —á–∞—Å–∞
4. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### Callbacks (–∫–æ–ª–±—ç–∫–∏)

#### signIn callback - –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
```typescript
async signIn({ user, account, profile }) {
  // –†–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø –¢–û–õ–¨–ö–û –¥–ª—è kirdro@yandex.ru
  if (user.email !== "kirdro@yandex.ru") {
    console.log(`‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ—Å—Ç—É–ø –¥–ª—è: ${user.email}`);
    return false;
  }
  return true;
}
```

#### jwt callback - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞
```typescript
async jwt({ token, user, account }) {
  if (user) {
    // –ù–∞–∑–Ω–∞—á–∞–µ–º —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é
    token.role = user.email === "kirdro@yandex.ru" ? "ADMIN" : "USER";
  }
  return token;
}
```

#### session callback - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–∏
```typescript
async session({ session, token }) {
  if (token) {
    session.user.id = token.sub!;
    session.user.role = token.role as string;
  }
  return session;
}
```

## üõ°Ô∏è Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤

### –§–∞–π–ª: `src/middleware.ts`

```typescript
export async function middleware(request: NextRequest) {
  const token = await getToken({ req: request });
  
  // –ò—Å–∫–ª—é—á–µ–Ω–∏—è (–ø—É–±–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏)
  const isPublicPath = 
    request.nextUrl.pathname.startsWith('/api/auth') ||
    request.nextUrl.pathname.startsWith('/auth') ||
    request.nextUrl.pathname.startsWith('/_next') ||
    request.nextUrl.pathname === '/favicon.ico';

  if (isPublicPath) return NextResponse.next();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  if (!token) {
    return NextResponse.redirect(new URL("/auth/signin", request.url));
  }

  return NextResponse.next();
}
```

**–ú–∞—Ç—á–µ—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –º–∞—Ä—à—Ä—É—Ç–∞–º:**
```typescript
export const config = {
  matcher: ['/((?!_next/static|_next/image|favicon.ico).*)'],
};
```

## üé® –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞: `src/app/auth/signin/page.tsx`

#### –î–∏–∑–∞–π–Ω –≤ –∫–∏–±–µ—Ä–ø–∞–Ω–∫ —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–µ
- **–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞**: –¢–µ–º–Ω—ã–π —Ñ–æ–Ω (#0B0D0E) + –Ω–µ–æ–Ω–æ–≤—ã–π –∑–µ–ª–µ–Ω—ã–π (#00FF99)
- **–≠—Ñ—Ñ–µ–∫—Ç—ã**: –°–∫–∞–Ω–ª–∞–π–Ω—ã, –≥–ª–∏—Ç—á-–∫–Ω–æ–ø–∫–∏, —Å–≤–µ—Ç–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
- **–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞**: –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
```typescript
// –í—Ö–æ–¥ —á–µ—Ä–µ–∑ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–Ø–Ω–¥–µ–∫—Å)
const handleProviderSignIn = async (providerId: string) => {
  await signIn(providerId, { callbackUrl: "/" });
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ email –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º
const handleEmailSignIn = async (e: React.FormEvent) => {
  if (!email || email !== "kirdro@yandex.ru") {
    alert("‚õî –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è kirdro@yandex.ru");
    return;
  }
  // ... –æ—Ç–ø—Ä–∞–≤–∫–∞ email magic link
};
```

#### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **–§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –ø–æ email** (–≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∞)
- **–ö–Ω–æ–ø–∫–∞ "–í—Ö–æ–¥ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å"** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç** - –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`

```bash
# NextAuth.js
NEXTAUTH_SECRET="your-secret-key"
NEXTAUTH_URL="http://localhost:3000"  # –∏–ª–∏ –≤–∞—à production URL

# Yandex OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
AUTH_YANDEX_ID="your-yandex-app-id"
AUTH_YANDEX_SECRET="your-yandex-app-secret"

# Email –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–æ—Ç–∫–ª—é—á–µ–Ω, –Ω–æ –º–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å)
# EMAIL_SERVER_HOST="smtp.yandex.ru"
# EMAIL_SERVER_PORT="465" 
# EMAIL_SERVER_USER="your-email@yandex.ru"
# EMAIL_SERVER_PASSWORD="your-app-password"
# EMAIL_FROM="your-email@yandex.ru"
```

## üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –Ø–Ω–¥–µ–∫—Å OAuth

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://oauth.yandex.ru/
2. –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: KIRDRO Admin Panel
   - **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã**: –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã
   - **Redirect URI**: 
     - Development: `http://localhost:3000/api/auth/callback/yandex`
     - Production: `https://admin.kirdro.ru/api/auth/callback/yandex`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞:
- ‚úÖ `login:email` - –¥–æ—Å—Ç—É–ø –∫ email –∞–¥—Ä–µ—Å—É
- ‚úÖ `login:info` - –¥–æ—Å—Ç—É–ø –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—É—á–∏—Ç–µ:
- **ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Üí `AUTH_YANDEX_ID`
- **–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Üí `AUTH_YANDEX_SECRET`

## üîí –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞

1. **OAuth —É—Ä–æ–≤–µ–Ω—å**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å OAuth
2. **Callback —É—Ä–æ–≤–µ–Ω—å**: –ø—Ä–æ–≤–µ—Ä–∫–∞ email –≤ `signIn` callback
3. **Middleware —É—Ä–æ–≤–µ–Ω—å**: –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
4. **UI —É—Ä–æ–≤–µ–Ω—å**: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ email –≤ —Ñ–æ—Ä–º–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```typescript
// –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
events: {
  async signIn({ user, account }) {
    console.log(`üìÖ SignIn event: ${user.email} via ${account?.provider}`);
  },
  async signOut({ token }) {
    console.log(`üëã SignOut event: ${token?.email}`);
  },
  // ... –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—É–∫–∏

```typescript
cookies: {
  sessionToken: {
    name: "next-auth.session-token",
    options: {
      httpOnly: true,        // –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
      sameSite: "lax",       // CSRF protection  
      path: "/",
      secure: process.env.NODE_ENV === "production",  // HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
    },
  },
}
```

## üöÄ Deployment (–î–µ–ø–ª–æ–π)

### Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. **NEXTAUTH_URL** - –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ production –¥–æ–º–µ–Ω
2. **Yandex OAuth Redirect URI** - –¥–æ–±–∞–≤–∏—Ç—å production URL
3. **NEXTAUTH_SECRET** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–π —Å–µ–∫—Ä–µ—Ç
4. **SSL/HTTPS** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è production

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bun install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏  
bun dev

# –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
bun build

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞
bun start
```

## üêõ Troubleshooting (–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º)

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

#### 1. "Configuration error" 
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `.env` —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

#### 2. "Redirect URI mismatch"
**–ü—Ä–∏—á–∏–Ω–∞**: URL –≤ –Ø–Ω–¥–µ–∫—Å OAuth –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å Redirect URI –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### 3. "Access denied"
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–º email
**–†–µ—à–µ–Ω–∏–µ**: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è `kirdro@yandex.ru`

### –û—Ç–ª–∞–¥–∫–∞

```typescript
// –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ NextAuth.js
// –í .env –¥–æ–±–∞–≤–∏—Ç—å:
NEXTAUTH_DEBUG=true
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–æ–±—ã—Ç–∏—è –∫–æ—Ç–æ—Ä—ã–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

- ‚úÖ –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞ (—É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ)
- ‚úÖ –í—ã—Ö–æ–¥—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã  
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ —Å–µ—Å—Å–∏—è–º
- ‚úÖ –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤

```
üîê SignIn callback started for: kirdro@yandex.ru
üìã Account provider: yandex
‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø –¥–ª—è: kirdro@yandex.ru (45ms)
üé´ JWT callback started for: kirdro@yandex.ru
üé≠ Role assigned: ADMIN (fast mode)
üìù Session callback started for: kirdro@yandex.ru
üé™ Final session: {"user":{"id":"..","email":"kirdro@yandex.ru","role":"ADMIN"}}
```

## üîÑ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. **–ê—É–¥–∏—Ç –ª–æ–≥–∏ –≤ –ë–î** - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
3. **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫
4. **IP whitelist** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP –∞–¥—Ä–µ—Å–∞–º
5. **Session management** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏

---

**üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.